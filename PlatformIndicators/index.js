(function(g,h,i,E,m,o,c,w,N,t,M){"use strict";const{View:x,Text:J,Pressable:K}=c.ReactNative,P=i.findByName("Svg",!1).default,V=i.findByName("Svg",!1).Path,k={desktop:"M4 2.5c-1.103 0-2 .897-2 2v11c0 1.104.897 2 2 2h7v2H7v2h10v-2h-4v-2h7c1.103 0 2-.896 2-2v-11c0-1.103-.897-2-2-2H4Zm16 2v9H4v-9h16Z",web:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93Zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39Z",mobile:"M15.5 1h-8A2.5 2.5 0 0 0 5 3.5v17A2.5 2.5 0 0 0 7.5 23h8a2.5 2.5 0 0 0 2.5-2.5v-17A2.5 2.5 0 0 0 15.5 1zm-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5-4H7V4h9v14z"};function H(r){const{platform:l,color:f}=r;return React.createElement(x,null,React.createElement(P,{height:"16",width:"16",viewBox:"0 0 24 24",fill:f},React.createElement(V,{d:k[l]})))}const F={online:c.chroma(w.rawColors.GREEN_360).hex(),dnd:c.chroma(w.rawColors.RED_400).hex(),idle:c.chroma(w.rawColors.YELLOW_300).hex(),offline:c.chroma(w.rawColors.PRIMARY_400).hex()};function U(r){return F[r]}const A=i.findByStoreName("PresenceStore"),L=i.findByStoreName("SessionsStore"),O=i.findByStoreName("UserStore");let I,R=0,D,C;function j(){return D||(D=setTimeout(function(){R=0,D=null},5e3)),(!I||R==0)&&(I=A.getState()),R=(R+1)%20,I}function Z(r){let l;return C||(C=O.getCurrentUser().id),r==C?l=Object.values(L.getSessions()).reduce(function(f,p){return p.clientInfo.client!=="unknown"&&(f[p.clientInfo.client]=p.status),f},{}):l=j()?.clientStatuses[r],l}function v(r){const l=r.userId,f=Z(l);return o.createElement(o.Fragment,null,Object.keys(f??{}).map(function(p){return o.createElement(H,{platform:p,color:U(f[p])})}))}const{View:z,ScrollView:G}=c.ReactNative;function Y(){return M.useProxy(t.storage),c.React.createElement(G,null,c.React.createElement(z,null,c.React.createElement(E.Forms.FormSwitchRow,{label:"Show icons on the dm top bar",value:t.storage.dmTopBar??!0,onValueChange:function(r){return t.storage.dmTopBar=r},note:""}),c.React.createElement(E.Forms.FormSwitchRow,{label:"Show icons on the users and DMs list",value:t.storage.userList??!0,onValueChange:function(r){return t.storage.userList=r},note:""}),c.React.createElement(E.Forms.FormSwitchRow,{label:"Show icons on user profiles",value:t.storage.profileUsername??!0,onValueChange:function(r){return t.storage.profileUsername=r},note:""}),c.React.createElement(E.Forms.FormSwitchRow,{label:"Hide mobile status from the normal indicator",value:t.storage.removeDefaultMobile??!0,onValueChange:function(r){return t.storage.removeDefaultMobile=r},note:""})))}const W=function(r){let{children:l}=r;const[f,p]=o.useState(0);return o.useEffect(function(){const n=function(){p(function(e){return e+1})};return c.FluxDispatcher.subscribe("PRESENCE_UPDATES",n),function(){c.FluxDispatcher.unsubscribe("PRESENCE_UPDATES",n)}},[]),o.Children.map(l,function(n,e){return o.cloneElement(n,{key:`${e}-${f}`})})},{Text:Q,View:S}=E.General;let y=[];var q={onLoad:function(){t.storage.dmTopBar??=!0,t.storage.userList??=!0,t.storage.profileUsername??=!0,t.storage.removeDefaultMobile??=!0,y.push(h.patcher.after("render",S,function(n,e){if(!t.storage.dmTopBar)return;const s=m.findInReactTree(e,function(a){return a?.props?.children[1]?.type?.name=="ChannelActivity"&&a?.props?.children[1]?.props?.hasOwnProperty?.("userId")});if(!s||(console.log("hh"),s.props?.children?.length!=2)||s.props?.children[0]?.props?.children?.length!=2)return;const d=s.props?.children[0]?.props?.children;if(d.filter(function(a){return a?.props?.userId}).length==2){const a=d[1],b=a.props?.userId;if(!b)return;h.patcher.after("type",a,function(T,u){return m.findInReactTree(u,function(B){return B.key=="StatusIcons"})||(u=o.createElement(S,{style:{display:"flex",flexDirection:"row"}},u,o.createElement(W,{key:"StatusIcons"},o.createElement(v,{userId:b})))),u})}}));const r=i.findByDisplayName("Pressable",!1);y.push(h.patcher.before("render",r.default.type,function(n){if(!n||!n[0])return;const[e]=n;if(e&&e.accessibilityRole=="button"){if(!t.storage.userList)return;if(e.children&&e.children.length>=2&&e.children[0]?.props?.user){if(!e.children[0]||!e.children[0]?.props?.user)return;const s=e.children[0]?.props?.user?.id;if(!s)return;e.children?.find(function(a){return a.key=="StatusIcons"})||e.children.push(o.createElement(S,{key:"StatusIcons",style:{display:"flex",flexDirection:"row"}}));const d=e.children?.find(function(a){return a.key=="StatusIcons"});d.props.children=o.createElement(v,{userId:s})}}})),i.findByStoreName("PresenceStore"),y.push(h.patcher.after("type",i.findByProps("DirectMessageRow").DirectMessageRow,function(n,e){if(!e.props?.user)return;e.props?.user?.id&&h.patcher.after("type",e,function(d,a){})})),y.push(h.patcher.after("default",i.findByName("ChannelHeader",!1),function(n,e){t.storage.dmTopBar&&e.type?.type?.name=="PrivateChannelHeader"&&h.patcher.after("type",e.type,function(s,d){if(!d.props?.children?.props?.children)return;const a=m.findInReactTree(d,function(u){return u.props?.user?.id})?.props?.user?.id;if(!a)return;const b=d.props?.children;if(!m.findInReactTree(d,function(u){return u.key=="DMTabsV2Header"})){const u=N.getAssetIDByName("arrow-right");m.findInReactTree(b,function(B){return B.props?.children[1]?.props?.source==u}).props?.children?.push(o.createElement(S,{key:"DMTabsV2Header",style:{flexDirection:"row",justifyContent:"center",alignContent:"flex-start"}},o.createElement(S,{key:"DMTabsV2HeaderIcons",style:{flexDirection:"row"}})))}const T=m.findInReactTree(d,function(u){return u.key=="DMTabsV2HeaderIcons"});T&&(T.props.children=o.createElement(v,{userId:a}))})}));const l=i.findByName("DefaultName",!1);y.push(h.patcher.after("default",l,function(n,e){const s=n[0]?.user;s!==void 0&&e&&s.id&&t.storage.profileUsername&&e.props?.children[0]?.props?.children?.push(o.createElement(v,{userId:s.id}))}));const f=i.findByName("DisplayName",!1);y.push(h.patcher.after("default",f,function(n,e){const s=n[0]?.user;s!==void 0&&e&&s.id&&t.storage.profileUsername&&e.props?.children?.props?.children[0]?.props?.children?.push(o.createElement(v,{userId:s.id}))}));const p=i.findByName("Status",!1);y.push(h.patcher.before("default",p,function(n){n&&n[0]&&t.storage.removeDefaultMobile&&(n[0].isMobileOnline=!1)}))},onUnload:function(){y.forEach(function(r){return r()})},settings:function(){return o.createElement(Y,null)}};return g.default=q,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta,vendetta.metro,vendetta.ui.components,vendetta.utils,window.React,vendetta.metro.common,vendetta.ui,vendetta.ui.assets,vendetta.plugin,vendetta.storage);
