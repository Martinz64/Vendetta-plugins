(function(g,u,l,b,d,r,i,I,t,k,x){"use strict";const{View:B,Text:_,Pressable:$}=i.ReactNative,N=l.findByName("Svg",!1).default,P=l.findByName("Svg",!1).Path,F={desktop:"M4 2.5c-1.103 0-2 .897-2 2v11c0 1.104.897 2 2 2h7v2H7v2h10v-2h-4v-2h7c1.103 0 2-.896 2-2v-11c0-1.103-.897-2-2-2H4Zm16 2v9H4v-9h16Z",web:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93Zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39Z",mobile:"M15.5 1h-8A2.5 2.5 0 0 0 5 3.5v17A2.5 2.5 0 0 0 7.5 23h8a2.5 2.5 0 0 0 2.5-2.5v-17A2.5 2.5 0 0 0 15.5 1zm-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5-4H7V4h9v14z",embedded:"M5.79335761,5 L18.2066424,5 C19.7805584,5 21.0868816,6.21634264 21.1990185,7.78625885 L21.8575059,17.0050826 C21.9307825,18.0309548 21.1585512,18.9219909 20.132679,18.9952675 C20.088523,18.9984215 20.0442685,19 20,19 C18.8245863,19 17.8000084,18.2000338 17.5149287,17.059715 L17,15 L7,15 L6.48507125,17.059715 C6.19999155,18.2000338 5.1754137,19 4,19 C2.97151413,19 2.13776159,18.1662475 2.13776159,17.1377616 C2.13776159,17.0934931 2.1393401,17.0492386 2.1424941,17.0050826 L2.80098151,7.78625885 C2.91311838,6.21634264 4.21944161,5 5.79335761,5 Z M14.5,10 C15.3284271,10 16,9.32842712 16,8.5 C16,7.67157288 15.3284271,7 14.5,7 C13.6715729,7 13,7.67157288 13,8.5 C13,9.32842712 13.6715729,10 14.5,10 Z M18.5,13 C19.3284271,13 20,12.3284271 20,11.5 C20,10.6715729 19.3284271,10 18.5,10 C17.6715729,10 17,10.6715729 17,11.5 C17,12.3284271 17.6715729,13 18.5,13 Z M6,9 L4,9 L4,11 L6,11 L6,13 L8,13 L8,11 L10,11 L10,9 L8,9 L8,7 L6,7 L6,9 ZM5.79335761,5 L18.2066424,5 C19.7805584,5 21.0868816,6.21634264 21.1990185,7.78625885 L21.8575059,17.0050826 C21.9307825,18.0309548 21.1585512,18.9219909 20.132679,18.9952675 C20.088523,18.9984215 20.0442685,19 20,19 C18.8245863,19 17.8000084,18.2000338 17.5149287,17.059715 L17,15 L7,15 L6.48507125,17.059715 C6.19999155,18.2000338 5.1754137,19 4,19 C2.97151413,19 2.13776159,18.1662475 2.13776159,17.1377616 C2.13776159,17.0934931 2.1393401,17.0492386 2.1424941,17.0050826 L2.80098151,7.78625885 C2.91311838,6.21634264 4.21944161,5 5.79335761,5 Z M14.5,10 C15.3284271,10 16,9.32842712 16,8.5 C16,7.67157288 15.3284271,7 14.5,7 C13.6715729,7 13,7.67157288 13,8.5 C13,9.32842712 13.6715729,10 14.5,10 Z M18.5,13 C19.3284271,13 20,12.3284271 20,11.5 C20,10.6715729 19.3284271,10 18.5,10 C17.6715729,10 17,10.6715729 17,11.5 C17,12.3284271 17.6715729,13 18.5,13 Z M6,9 L4,9 L4,11 L6,11 L6,13 L8,13 L8,11 L10,11 L10,9 L8,9 L8,7 L6,7 L6,9 Z"};function Z(n){const{platform:p,color:h}=n;return React.createElement(B,null,React.createElement(N,{height:"16",width:"16",viewBox:"0 0 24 24",fill:h},React.createElement(P,{d:F[p]})))}const H={online:i.chroma(I.rawColors.GREEN_360).hex(),dnd:i.chroma(I.rawColors.RED_400).hex(),idle:i.chroma(I.rawColors.YELLOW_300).hex(),offline:i.chroma(I.rawColors.PRIMARY_400).hex()},U={online:"#23a55a",dnd:"#f23f43",idle:"#f0b232",offline:"#80848e"};function A(n){return arguments.length>1&&arguments[1]!==void 0&&arguments[1]?U[n]:H[n]}const G=l.findByStoreName("PresenceStore"),O=l.findByStoreName("SessionsStore"),j=l.findByStoreName("UserStore");let M,v=0,D,T;function z(){return D||(D=setTimeout(function(){v=0,D=null},5e3)),(!M||v==0)&&(M=G.getState()),v=(v+1)%20,M}function Y(n){let p;return T||(T=j.getCurrentUser()?.id),n==T?p=Object.values(O.getSessions()).reduce(function(h,y){return y.clientInfo.client!=="unknown"&&(h[y.clientInfo.client]=y.status),h},{}):p=z()?.clientStatuses[n],p}function w(n){k.useProxy(t.storage);const p=n.userId,h=Y(p);return r.createElement(r.Fragment,null,Object.keys(h??{}).map(function(y){return r.createElement(Z,{platform:y,color:A(h[y],t.storage.fallbackColors)})}))}const{View:W,ScrollView:q}=i.ReactNative;function J(){return k.useProxy(t.storage),i.React.createElement(q,null,i.React.createElement(W,null,i.React.createElement(b.Forms.FormSwitchRow,{label:"Show icons on the dm top bar",value:t.storage.dmTopBar??!0,onValueChange:function(n){return t.storage.dmTopBar=n},note:""}),i.React.createElement(b.Forms.FormSwitchRow,{label:"Show icons on the users and DMs list",value:t.storage.userList??!0,onValueChange:function(n){return t.storage.userList=n},note:""}),i.React.createElement(b.Forms.FormSwitchRow,{label:"Show icons on user profiles",value:t.storage.profileUsername??!0,onValueChange:function(n){return t.storage.profileUsername=n},note:""}),i.React.createElement(b.Forms.FormSwitchRow,{label:"Hide mobile status from the normal indicator",value:t.storage.removeDefaultMobile??!0,onValueChange:function(n){return t.storage.removeDefaultMobile=n},note:""}),i.React.createElement(b.Forms.FormSwitchRow,{label:"Theme compatibility mode",value:t.storage.fallbackColors??!1,onValueChange:function(n){return t.storage.fallbackColors=n},note:""})))}const K=function(n){let{children:p}=n;const[h,y]=r.useState(0);return r.useEffect(function(){const E=function(){y(function(R){return R+1})};return i.FluxDispatcher.subscribe("PRESENCE_UPDATES",E),function(){i.FluxDispatcher.unsubscribe("PRESENCE_UPDATES",E)}},[]),r.Children.map(p,function(E,R){return r.cloneElement(E,{key:`${R}-${h}`})})},{Text:Q,View:C}=b.General;let m=[];var X={onLoad:function(){t.storage.dmTopBar??=!0,t.storage.userList??=!0,t.storage.profileUsername??=!0,t.storage.removeDefaultMobile??=!0,t.storage.fallbackColors??=!1,m.push(u.patcher.after("render",C,function(s,e){if(!t.storage.dmTopBar)return;const o=d.findInReactTree(e,function(c){return c?.props?.children[1]?.type?.name=="ChannelActivity"&&c?.props?.children[1]?.props?.hasOwnProperty?.("userId")});if(!o||o.props?.children?.length!=2||o.props?.children[0]?.props?.children?.length!=2)return;const a=o.props?.children[0]?.props?.children;if(a.filter(function(c){return c?.props?.userId}).length==2){const c=a[1],L=c.props?.userId;if(!L)return;u.patcher.after("type",c,function(S,f){return d.findInReactTree(f,function(V){return V.key=="StatusIcons"})||(f=r.createElement(C,{style:{display:"flex",flexDirection:"row"}},f,r.createElement(K,{key:"StatusIcons"},r.createElement(w,{userId:L})))),f})}}));const n=l.findByDisplayName("Pressable",!1);m.push(u.patcher.before("render",n.default.type,function(s){if(!s||!s[0])return;const[e]=s;if(e&&e.accessibilityRole=="button"){if(!t.storage.userList)return;if(e.children&&e.children.length>=2&&e.children[0]?.props?.user&&e.children[0]?.props?.channel){if(!e.children[0]||!e.children[0]?.props?.user)return;const o=e.children[0]?.props?.user?.id;if(!o)return;e.children?.find(function(c){return c.key=="StatusIcons"})||e.children.push(r.createElement(C,{key:"StatusIcons",style:{display:"flex",flexDirection:"row"}}));const a=e.children?.find(function(c){return c.key=="StatusIcons"});a.props.children=r.createElement(w,{userId:o})}}})),l.findByStoreName("PresenceStore"),m.push(u.patcher.after("type",l.findByProps("DirectMessageRow").DirectMessageRow,function(s,e){if(!e.props?.user)return;const o=e.props?.user?.id;o&&u.patcher.after("type",e,function(a,c){const L=d.findInReactTree(c,function(S){return S.props?.children[0]?.type?.displayName=="View"});L.props.children[0].props.children[0]=r.createElement(C,{style:{flexDirection:"row"}},L.props.children[0].props.children[0],r.createElement(C,{style:{marginLeft:2,flexDirection:"row"}},r.createElement(w,{userId:o})))})})),m.push(u.patcher.after("default",l.findByName("ChannelHeader",!1),function(s,e){t.storage.dmTopBar&&e.type?.type?.name=="PrivateChannelHeader"&&u.patcher.after("type",e.type,function(o,a){if(!a.props?.children?.props?.children)return;const c=d.findInReactTree(a,function(f){return f.props?.user?.id})?.props?.user?.id;if(!c)return;const L=a.props?.children;if(!d.findInReactTree(a,function(f){return f.key=="DMTabsV2Header"})){const f=x.getAssetIDByName("arrow-right");d.findInReactTree(L,function(V){return V.props?.children[1]?.props?.source==f}).props?.children?.push(r.createElement(C,{key:"DMTabsV2Header",style:{flexDirection:"row",justifyContent:"center",alignContent:"flex-start"}},r.createElement(C,{key:"DMTabsV2HeaderIcons",style:{flexDirection:"row"}})))}const S=d.findInReactTree(a,function(f){return f.key=="DMTabsV2HeaderIcons"});S&&(S.props.children=r.createElement(w,{userId:c}))})}));const p=l.findByName("DefaultName",!1);m.push(u.patcher.after("default",p,function(s,e){const o=s[0]?.user;o!==void 0&&e&&o.id&&t.storage.profileUsername&&e.props?.children[0]?.props?.children?.push(r.createElement(w,{userId:o.id}))}));const h=l.findByName("DisplayName",!1);m.push(u.patcher.after("default",h,function(s,e){const o=s[0]?.user;o!==void 0&&e&&o.id&&t.storage.profileUsername&&e.props?.children?.props?.children[0]?.props?.children?.push(r.createElement(w,{userId:o.id}))}));const y=l.findByName("Status",!1);m.push(u.patcher.before("default",y,function(s){s&&s[0]&&t.storage.removeDefaultMobile&&(s[0].isMobileOnline=!1)}));const E=l.findByProps("GuildMemberRow");m.push(u.patcher.after("type",E.GuildMemberRow,function(s,e){let[{user:o}]=s;t.storage.userList&&(d.findInReactTree(e,function(a){return a.key=="GuildMemberRowStatusIconsView"})||d.findInReactTree(e,function(a){return a.props.style.flexDirection==="row"}).props.children.splice(2,0,r.createElement(C,{key:"GuildMemberRowStatusIconsView",style:{flexDirection:"row"}},r.createElement(w,{userId:o.id}))))}));const R=function(s,e){let[{user:o}]=s;if(t.storage.userList&&!d.findInReactTree(e,function(a){return a.key=="TabsV2MemberListStatusIconsView"})){const a=d.findInReactTree(e.props.label,function(c){return c.props?.lineClamp}).props.children;a.props.children[1]=r.createElement(C,{key:"TabsV2MemberListStatusIconsView"},r.createElement(Q,null," "),r.createElement(w,{userId:o.id}))}};l.findByTypeNameAll("UserRow").forEach(function(s){return m.push(u.patcher.after("type",s,R))})},onUnload:function(){m.forEach(function(n){return n()})},settings:function(){return r.createElement(J,null)}};return g.default=X,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta,vendetta.metro,vendetta.ui.components,vendetta.utils,window.React,vendetta.metro.common,vendetta.ui,vendetta.plugin,vendetta.storage,vendetta.ui.assets);
