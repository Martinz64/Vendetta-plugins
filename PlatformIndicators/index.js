(function(S,f,d,L,l,t,a,E,g,r,N){"use strict";const{View:U,Text:ne,Image:F,Pressable:se}=a.ReactNative,P=d.findByName("Svg",!1).default,H=d.findByName("Svg",!1).Path,A={desktop:"M4 2.5c-1.103 0-2 .897-2 2v11c0 1.104.897 2 2 2h7v2H7v2h10v-2h-4v-2h7c1.103 0 2-.896 2-2v-11c0-1.103-.897-2-2-2H4Zm16 2v9H4v-9h16Z",web:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93Zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39Z",mobile:"M15.5 1h-8A2.5 2.5 0 0 0 5 3.5v17A2.5 2.5 0 0 0 7.5 23h8a2.5 2.5 0 0 0 2.5-2.5v-17A2.5 2.5 0 0 0 15.5 1zm-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5-4H7V4h9v14z",embedded:"M5.79335761,5 L18.2066424,5 C19.7805584,5 21.0868816,6.21634264 21.1990185,7.78625885 L21.8575059,17.0050826 C21.9307825,18.0309548 21.1585512,18.9219909 20.132679,18.9952675 C20.088523,18.9984215 20.0442685,19 20,19 C18.8245863,19 17.8000084,18.2000338 17.5149287,17.059715 L17,15 L7,15 L6.48507125,17.059715 C6.19999155,18.2000338 5.1754137,19 4,19 C2.97151413,19 2.13776159,18.1662475 2.13776159,17.1377616 C2.13776159,17.0934931 2.1393401,17.0492386 2.1424941,17.0050826 L2.80098151,7.78625885 C2.91311838,6.21634264 4.21944161,5 5.79335761,5 Z M14.5,10 C15.3284271,10 16,9.32842712 16,8.5 C16,7.67157288 15.3284271,7 14.5,7 C13.6715729,7 13,7.67157288 13,8.5 C13,9.32842712 13.6715729,10 14.5,10 Z M18.5,13 C19.3284271,13 20,12.3284271 20,11.5 C20,10.6715729 19.3284271,10 18.5,10 C17.6715729,10 17,10.6715729 17,11.5 C17,12.3284271 17.6715729,13 18.5,13 Z M6,9 L4,9 L4,11 L6,11 L6,13 L8,13 L8,11 L10,11 L10,9 L8,9 L8,7 L6,7 L6,9 ZM5.79335761,5 L18.2066424,5 C19.7805584,5 21.0868816,6.21634264 21.1990185,7.78625885 L21.8575059,17.0050826 C21.9307825,18.0309548 21.1585512,18.9219909 20.132679,18.9952675 C20.088523,18.9984215 20.0442685,19 20,19 C18.8245863,19 17.8000084,18.2000338 17.5149287,17.059715 L17,15 L7,15 L6.48507125,17.059715 C6.19999155,18.2000338 5.1754137,19 4,19 C2.97151413,19 2.13776159,18.1662475 2.13776159,17.1377616 C2.13776159,17.0934931 2.1393401,17.0492386 2.1424941,17.0050826 L2.80098151,7.78625885 C2.91311838,6.21634264 4.21944161,5 5.79335761,5 Z M14.5,10 C15.3284271,10 16,9.32842712 16,8.5 C16,7.67157288 15.3284271,7 14.5,7 C13.6715729,7 13,7.67157288 13,8.5 C13,9.32842712 13.6715729,10 14.5,10 Z M18.5,13 C19.3284271,13 20,12.3284271 20,11.5 C20,10.6715729 19.3284271,10 18.5,10 C17.6715729,10 17,10.6715729 17,11.5 C17,12.3284271 17.6715729,13 18.5,13 Z M6,9 L4,9 L4,11 L6,11 L6,13 L8,13 L8,11 L10,11 L10,9 L8,9 L8,7 L6,7 L6,9 Z"},Z={desktop:E.getAssetIDByName("ic_monitor_24px"),web:E.getAssetIDByName("ic_globe_24px"),mobile:E.getAssetIDByName("ic_mobile_device"),embedded:E.getAssetIDByName("ic_monitor_24px")};function $(n){const{platform:p,color:h,useNative:m}=n;return React.createElement(U,null,m?React.createElement(F,{style:{height:16,width:16,tintColor:h},source:Z[p]}):React.createElement(P,{height:"16",width:"16",viewBox:"0 0 24 24",fill:h},React.createElement(H,{d:A[p]})))}const G={online:a.chroma(g.rawColors.GREEN_360).hex(),dnd:a.chroma(g.rawColors.RED_400).hex(),idle:a.chroma(g.rawColors.YELLOW_300).hex(),offline:a.chroma(g.rawColors.PRIMARY_400).hex()},O={online:"#23a55a",dnd:"#f23f43",idle:"#f0b232",offline:"#80848e"};function j(n){return arguments.length>1&&arguments[1]!==void 0&&arguments[1]?O[n]:G[n]}const _=d.findByStoreName("PresenceStore"),z=d.findByStoreName("SessionsStore"),Y=d.findByStoreName("UserStore");let T,M=0,V,k;function Q(){return V||(V=setTimeout(function(){M=0,V=null},5e3)),(!T||M==0)&&(T=_.getState()),M=(M+1)%20,T}function W(n){let p;return k||(k=Y.getCurrentUser()?.id),n==k?p=Object.values(z.getSessions()).reduce(function(h,m){return m.clientInfo.client!=="unknown"&&(h[m.clientInfo.client]=m.status),h},{}):p=Q()?.clientStatuses[n],p}function b(n){N.useProxy(r.storage);const p=n.userId,h=W(p);return t.createElement(t.Fragment,null,Object.keys(h??{}).map(function(m){return t.createElement($,{platform:m,color:j(h[m],r.storage.fallbackColors),useNative:r.storage.useNativeIcons})}))}const{View:q,ScrollView:J}=a.ReactNative;function K(){return N.useProxy(r.storage),a.React.createElement(J,null,a.React.createElement(q,null,a.React.createElement(L.Forms.FormSwitchRow,{label:"Show icons on the dm top bar",value:r.storage.dmTopBar??!0,onValueChange:function(n){return r.storage.dmTopBar=n},note:""}),a.React.createElement(L.Forms.FormSwitchRow,{label:"Show icons on the users and DMs list",value:r.storage.userList??!0,onValueChange:function(n){return r.storage.userList=n},note:""}),a.React.createElement(L.Forms.FormSwitchRow,{label:"Show icons on user profiles",value:r.storage.profileUsername??!0,onValueChange:function(n){return r.storage.profileUsername=n},note:""}),a.React.createElement(L.Forms.FormSwitchRow,{label:"Hide mobile status from the normal indicator",value:r.storage.removeDefaultMobile??!0,onValueChange:function(n){return r.storage.removeDefaultMobile=n},note:""}),a.React.createElement(L.Forms.FormSwitchRow,{label:"Theme compatibility mode",value:r.storage.fallbackColors??!1,onValueChange:function(n){return r.storage.fallbackColors=n},note:""}),a.React.createElement(L.Forms.FormSwitchRow,{label:"Old user list icon style",value:r.storage.oldUserListIcons??!1,onValueChange:function(n){return r.storage.oldUserListIcons=n},note:"Moves status indicators to the right"}),a.React.createElement(L.Forms.FormSwitchRow,{label:"Icon theming compatibility",value:r.storage.useNativeIcons??!0,onValueChange:function(n){return r.storage.useNativeIcons=n},note:"Use native icons to allow icon theming"})))}const D=function(n){let{children:p}=n;const[h,m]=t.useState(0);return t.useEffect(function(){const w=function(){m(function(v){return v+1})};return a.FluxDispatcher.subscribe("PRESENCE_UPDATES",w),function(){a.FluxDispatcher.unsubscribe("PRESENCE_UPDATES",w)}},[]),t.Children.map(p,function(w,v){return t.cloneElement(w,{key:`${v}-${h}`})})},{Text:oe,View:I}=L.General;let C=[];var X={onLoad:function(){r.storage.dmTopBar??=!0,r.storage.userList??=!0,r.storage.profileUsername??=!0,r.storage.removeDefaultMobile??=!0,r.storage.fallbackColors??=!1,r.storage.oldUserListIcons??=!1,r.storage.useNativeIcons??=!0,C.push(f.patcher.after("render",I,function(i,e){if(r.storage.dmTopBar){const s=l.findInReactTree(e,function(o){return o?.props?.children[1]?.type?.name=="ChannelActivity"&&o?.props?.children[1]?.props?.hasOwnProperty?.("userId")});if(!s||s.props?.children?.length!=2||s.props?.children[0]?.props?.children?.length!=2)return;const c=s.props?.children[0]?.props?.children;if(c.filter(function(o){return o?.props?.userId}).length==2){const o=c[1],y=o.props?.userId;if(!y)return;f.patcher.after("type",o,function(x,u){return l.findInReactTree(u,function(R){return R.key=="StatusIcons"})||(u=t.createElement(I,{style:{display:"flex",flexDirection:"row"}},u,t.createElement(D,{key:"StatusIcons"},t.createElement(b,{userId:y})))),u})}}}));const n=d.findByDisplayName("Pressable",!1);C.push(f.patcher.before("render",n.default.type,function(i){if(!i||!i[0])return;const[e]=i;if(e){if(r.storage.userList&&e?.children?.props?.children?.props?.children&&e.children.props.children.props.children[1]?.type?.type?.name=="ChannelUnreadBadge"){const s=e.children.props.children,c=l.findInReactTree(s,function(o){return o?.user});if(c?.user&&!l.findInReactTree(e,function(o){return o?.key=="TabsV2-DM-List"})){const o=l.findInReactTree(e,function(y){return y?.props?.variant=="text-md/semibold"||y?.props?.variant=="redesign/channel-title/semibold"});o&&(o.props.children=[o.props.children,t.createElement(I,{key:"TabsV2-DM-List",style:{flexDirection:"row",justifyContent:"center",alignContent:"flex-start"}},t.createElement(D,null,t.createElement(b,{userId:c.user.id})))])}}if(e.accessibilityRole=="button"){if(!r.storage.userList)return;if(e.children&&e.children.length>=2&&(e.children[0]?.props?.user&&e.children[0]?.props?.channel||r.storage.oldUserListIcons)){if(!e.children[0]||!e.children[0]?.props?.user)return;const s=e.children[0]?.props?.user?.id;if(!s)return;e.children?.find(function(o){return o.key=="StatusIcons"})||e.children.push(t.createElement(I,{key:"StatusIcons",style:{display:"flex",flexDirection:"row"}}));const c=e.children?.find(function(o){return o.key=="StatusIcons"});c.props.children=t.createElement(b,{userId:s})}}if(e.accessibilityRole=="button"){if(!r.storage.userList)return;if(e?.children?.props?.children?.props?.children&&e?.children?.props?.children?.props?.children[0]?.type?.type?.name=="GuildContainerIndicator"){const s=e?.children?.props?.children?.props?.children[1]?.props?.children[0]?.props?.children?.props?.user?.id;if(e?.children?.props?.children?.props?.children[1]?.props?.children[0]?.props?.children?.props?.guildId)return;if(s){const c=e?.children?.props?.children?.props?.children[2]?.props?.children[0];if(c){const o=c.props.children[0].props.children;l.findInReactTree(o,function(y){return y.key=="DMTabsV2DMList-v2"})||o.push(t.createElement(D,{key:"DMTabsV2DMList-v2"},t.createElement(b,{userId:s})))}}}}}})),d.findByStoreName("PresenceStore"),C.push(f.patcher.after("default",d.findByName("ChannelHeader",!1),function(i,e){r.storage.dmTopBar&&e.type?.type?.name=="PrivateChannelHeader"&&f.patcher.after("type",e.type,function(s,c){if(!c.props?.children?.props?.children)return;const o=l.findInReactTree(c,function(u){return u.props?.user?.id})?.props?.user?.id;if(!o)return;const y=c.props?.children;if(!l.findInReactTree(c,function(u){return u.key=="DMTabsV2Header"})&&y.props?.children?.props?.children[1])if(typeof y.props?.children?.props?.children[1]?.type=="function"){const u=y.props?.children?.props?.children[1],R=f.patcher.after("type",u,function(ce,B){R(),l.findInReactTree(B,function(te){return te.key=="DMTabsV2Header-v2"})||B.props.children[0].props.children.push(t.createElement(D,{key:"DMTabsV2Header-v2"},t.createElement(b,{userId:o})))})}else{const u=E.getAssetIDByName("arrow-right");l.findInReactTree(y,function(R){return R.props?.children[1]?.props?.source==u}).props?.children?.push(t.createElement(I,{key:"DMTabsV2Header",style:{flexDirection:"row",justifyContent:"center",alignContent:"flex-start"}},t.createElement(I,{key:"DMTabsV2HeaderIcons",style:{flexDirection:"row"}})))}const x=l.findInReactTree(c,function(u){return u.key=="DMTabsV2HeaderIcons"});x&&(x.props.children=t.createElement(b,{userId:o}))})}));const p=d.findByName("DefaultName",!1);C.push(f.patcher.after("default",p,function(i,e){const s=i[0]?.user;s!==void 0&&e&&s.id&&r.storage.profileUsername&&e.props?.children[0]?.props?.children?.push(t.createElement(b,{userId:s.id}))}));const h=d.findByName("DisplayName",!1);C.push(f.patcher.after("default",h,function(i,e){const s=i[0]?.user;s!==void 0&&e&&s.id&&r.storage.profileUsername&&e.props?.children?.props?.children[0]?.props?.children?.push(t.createElement(b,{userId:s.id}))}));const m=d.findByName("Status",!1);C.push(f.patcher.before("default",m,function(i){i&&i[0]&&r.storage.removeDefaultMobile&&(i[0].isMobileOnline=!1)}));const w=d.findByProps("GuildMemberRow");w?.GuildMemberRow&&C.push(f.patcher.after("type",w.GuildMemberRow,function(i,e){let[{user:s}]=i;!r.storage.userList||r.storage.oldUserListIcons||l.findInReactTree(e,function(c){return c.key=="GuildMemberRowStatusIconsView"})||l.findInReactTree(e,function(c){return c.props.style.flexDirection==="row"}).props.children.splice(2,0,t.createElement(I,{key:"GuildMemberRowStatusIconsView",style:{flexDirection:"row"}},t.createElement(b,{userId:s.id})))}));let v=!1;const ee=function(i,e){let[{user:s}]=i;r.storage.userList&&(l.findInReactTree(e?.props?.label,function(c){return c.key=="TabsV2MemberListStatusIconsView"})||(e.props.label=t.createElement(I,{style:{flex:1,justifyContent:r.storage.oldUserListIcons?"space-between":"flex-start",flexDirection:"row"},key:"TabsV2MemberListStatusIconsView"},e.props.label,t.createElement(I,{key:"TabsV2MemberListStatusIconsView",style:{flexDirection:"row"}},t.createElement(b,{userId:s.id}))),v||(C.push(f.patcher.before("type",e.props.icon.type,function(c){r.storage.removeDefaultMobile&&(c[0].isMobileOnline=!1)})),v=!0)))};d.findByTypeNameAll("UserRow").forEach(function(i){return C.push(f.patcher.after("type",i,ee))});const re=d.findByTypeName("MessagesItemChannelContent");C.push(f.patcher.after("type",re,function(i,e){console.log("MessagesItemChannelContent-B",i,e);const s=i[0]?.channel;if(s?.recipients?.length==1){const c=s.recipients[0];l.findInReactTree(e,function(o){return o.props.children[0].props.variant=="redesign/channel-title/semibold"}).props.children.push(t.createElement(I,{key:"TabsV2RedesignDMListIcons",style:{flexDirection:"row"}},t.createElement(b,{userId:c})))}}))},onUnload:function(){C.forEach(function(n){return n()})},settings:function(){return t.createElement(K,null)}};return S.default=X,Object.defineProperty(S,"__esModule",{value:!0}),S})({},vendetta,vendetta.metro,vendetta.ui.components,vendetta.utils,window.React,vendetta.metro.common,vendetta.ui.assets,vendetta.ui,vendetta.plugin,vendetta.storage);
